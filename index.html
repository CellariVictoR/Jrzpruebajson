<!DOCTYPE html>
<html class="light" lang="es">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Gestión de Zonas y Brigadistas</title>
    
    <!-- Fuentes e Iconos -->
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@400;500;600;700;800&amp;display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    
    <!-- Configuración de Tailwind -->
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#2563eb", 
                        "primary-dark": "#1d4ed8",
                        "secondary": "#7c3aed",
                        "text-main": "#020617",
                        "text-sub": "#334155",
                    },
                    fontFamily: {
                        "display": ["Public Sans", "sans-serif"]
                    },
                    borderRadius: { "DEFAULT": "0.5rem", "lg": "1rem", "xl": "1.5rem", "2xl": "2rem", "full": "9999px" },
                },
            },
        }
    </script>
    
    <style>
        /* TRANSICIÓN DE FONDO SUAVE */
        body {
            transition: background-image 0.5s ease-in-out, background-color 0.5s ease;
            min-height: 100vh;
            background-attachment: fixed;
        }

        /* 1. ESTILO PARA INICIO (Partículas Oscuras) */
        body.bg-home {
            background-color: #050505;
            background-image: url('https://cdn.svgator.com/images/2022/06/use-svg-as-background-image-particle-strokes.svg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        /* 2. ESTILO PARA CONTENIDO (Degradado Suave Original) */
        body.bg-content {
            background-color: #f3f4f6;
            background-image: 
                radial-gradient(at 40% 20%, hsla(210,100%,96%,1) 0px, transparent 50%),
                radial-gradient(at 80% 0%, hsla(189,100%,96%,1) 0px, transparent 50%),
                radial-gradient(at 0% 50%, hsla(341,100%,96%,1) 0px, transparent 50%),
                radial-gradient(at 80% 50%, hsla(240,100%,96%,1) 0px, transparent 50%),
                radial-gradient(at 0% 100%, hsla(220,100%,96%,1) 0px, transparent 50%),
                radial-gradient(at 80% 100%, hsla(240,100%,96%,1) 0px, transparent 50%),
                radial-gradient(at 0% 0%, hsla(343,100%,96%,1) 0px, transparent 50%);
            background-size: 200% 200%;
            animation: gradient-animation 15s ease infinite;
        }

        @keyframes gradient-animation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Estilo Glass Original */
        .glass-panel {
            @apply backdrop-blur-xl bg-white/95 dark:bg-slate-900/95 border border-white/60 dark:border-white/10 shadow-2xl shadow-black/20 dark:shadow-black/40;
        }
        
        .glass-input {
            @apply bg-white dark:bg-slate-800 border border-gray-300 dark:border-white/20 focus:ring-2 focus:ring-primary/20 outline-none transition-all placeholder:text-gray-400 text-text-main shadow-inner;
        }

        .title-backdrop {
            position: absolute;
            inset: -10px;
            background-color: rgba(0, 0, 0, 0.6);
            filter: blur(20px);
            border-radius: 9999px;
            z-index: -1;
        }

        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(156, 163, 175, 0.5); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(156, 163, 175, 0.8); }

        .saving-pulse { animation: pulse-border 1.5s infinite; }
        @keyframes pulse-border {
            0% { box-shadow: 0 0 0 0px rgba(37, 99, 235, 0.3); }
            50% { box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1); }
            100% { box-shadow: 0 0 0 0px rgba(37, 99, 235, 0); }
        }
        
        .preserve-whitespace { white-space: pre-wrap; }
        .perspective-1000 { perspective: 1000px; }
        
        .carousel-card {
            transition: all 0.5s cubic-bezier(0.23, 1, 0.32, 1);
            transform-style: preserve-3d;
        }
        .carousel-card:hover {
            transform: translateY(-10px) rotateX(2deg) rotateY(-2deg) scale(1.02);
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.2), 0 10px 10px -5px rgba(0,0,0,0.1), 0 0 20px rgba(37,99,235,0.4);
            border-color: rgba(37, 99, 235, 0.6);
            z-index: 10;
        }

        /* Mapa Leaflet */
        #leafletMap {
            width: 100%;
            height: 100%;
            z-index: 0;
            background: #e5e7eb;
        }
    </style>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
</head>
<body class="font-display text-text-main dark:text-white antialiased selection:bg-primary/30 bg-home">

    <!-- Top Navigation -->
    <header class="sticky top-4 z-50 mx-4 md:mx-8 glass-panel rounded-2xl mt-4">
        <div class="max-w-[1440px] mx-auto px-6 h-16 flex items-center justify-between">
            <div class="flex items-center gap-4">
                <div class="flex items-center justify-center size-10 bg-primary/10 text-primary rounded-xl border border-primary/20 bg-white">
                    <span class="material-symbols-outlined text-2xl">grid_view</span>
                </div>
                <div class="hidden sm:flex flex-col">
                    <h1 class="text-lg font-bold tracking-tight text-text-main dark:text-white leading-none">Despliegue Territorial</h1>
                    <span class="text-[10px] font-extrabold text-primary uppercase tracking-[0.2em] leading-tight">Ciudad Juárez</span>
                </div>
            </div>
            
            <nav class="hidden md:flex items-center gap-3">
                <button onclick="switchView('home')" id="nav-home" class="text-sm font-bold text-primary px-5 py-2.5 bg-white rounded-xl border border-primary/20 shadow-md transition-all hover:scale-105">Inicio</button>
                <button onclick="switchView('methodology')" id="nav-methodology" class="text-sm font-medium text-text-sub px-5 py-2.5 bg-white/80 hover:bg-white rounded-xl border border-transparent hover:border-gray-200 hover:shadow-md transition-all hover:text-primary">Metodología</button>
                <button onclick="switchView('dashboard')" id="nav-dashboard" class="text-sm font-medium text-text-sub px-5 py-2.5 bg-white/80 hover:bg-white rounded-xl border border-transparent hover:border-gray-200 hover:shadow-md transition-all hover:text-primary">Zonas</button>
                <button onclick="switchView('history')" id="nav-history" class="text-sm font-medium text-text-sub px-5 py-2.5 bg-white/80 hover:bg-white rounded-xl border border-transparent hover:border-gray-200 hover:shadow-md transition-all hover:text-primary">Histórico 18-24</button>
                
                <div class="h-8 w-px bg-gray-300 dark:bg-white/10 mx-2"></div>

                <!-- MAP BUTTON (Vuelve a abrir Modal General) -->
                <button onclick="openGeneralMap()" class="flex items-center gap-2 text-sm font-bold text-emerald-700 bg-emerald-50 border border-emerald-200 hover:bg-emerald-600 hover:text-white px-5 py-2.5 rounded-xl transition-all shadow-sm hover:shadow-emerald-500/30 hover:scale-105">
                    <span class="material-symbols-outlined text-[20px]">map</span>
                    Mapa General
                </button>
            </nav>
            
            <div class="flex items-center gap-3">
                <div id="save-status" class="hidden items-center gap-2 px-3 py-1 bg-green-500/10 text-green-700 dark:text-green-300 border border-green-500/20 rounded-full text-xs font-bold transition-all animate-bounce bg-white">
                    <span class="material-symbols-outlined text-sm">cloud_done</span> Guardado
                </div>
                <button class="p-2 text-text-sub bg-white/50 hover:bg-white rounded-full transition-all shadow-sm hover:shadow-md border border-transparent hover:border-gray-100">
                    <span class="material-symbols-outlined">notifications</span>
                </button>
            </div>
        </div>
    </header>

    <!-- HOME VIEW -->
    <main id="homeView" class="flex-1 max-w-[1440px] mx-auto w-full px-4 md:px-8 py-8 flex flex-col gap-8 h-[calc(100vh-120px)] justify-center perspective-1000">
        <div class="text-center space-y-4 mb-4">
            <div class="inline-block relative z-10">
                <div class="title-backdrop"></div>
                <h1 class="relative text-4xl md:text-6xl font-black tracking-tight text-white drop-shadow-lg animate-in fade-in zoom-in duration-700">Contexto Electoral</h1>
            </div>
            <div class="block relative z-0 mt-2">
                 <div class="inline-block relative">
                     <div class="title-backdrop opacity-60"></div>
                     <p class="relative text-lg md:text-xl text-gray-100 font-medium max-w-2xl mx-auto drop-shadow-md px-4">Seleccione un distrito local para explorar su análisis detallado.</p>
                 </div>
            </div>
        </div>
        <div class="relative w-full group/carousel" onmouseenter="stopCarousel()" onmouseleave="startCarousel()">
            <button onclick="scrollDistricts('left')" class="absolute left-2 md:left-0 top-1/2 -translate-y-1/2 md:-translate-x-4 z-20 p-3 md:p-4 rounded-full bg-white hover:bg-gray-50 text-primary shadow-xl transition-all duration-300 hover:scale-110 border border-gray-100"><span class="material-symbols-outlined text-3xl">chevron_left</span></button>
            <button onclick="scrollDistricts('right')" class="absolute right-2 md:right-0 top-1/2 -translate-y-1/2 md:translate-x-4 z-20 p-3 md:p-4 rounded-full bg-white hover:bg-gray-50 text-primary shadow-xl transition-all duration-300 hover:scale-110 border border-gray-100"><span class="material-symbols-outlined text-3xl">chevron_right</span></button>
            <div id="districtsContainer" class="flex gap-8 overflow-x-auto pb-12 pt-8 px-4 snap-x snap-mandatory scrollbar-hide scroll-smooth"></div>
        </div>
    </main>

    <!-- DASHBOARD VIEW -->
    <main id="dashboardView" class="hidden flex-1 max-w-[1440px] mx-auto w-full px-4 md:px-8 py-8 flex flex-col gap-6">
        <div class="flex flex-col gap-6">
            <div class="flex flex-col md:flex-row md:items-end justify-between gap-4">
                <div class="glass-panel p-6 rounded-2xl flex-1 border-l-4 border-l-primary shadow-xl">
                    <h2 class="text-3xl md:text-4xl font-black tracking-tight mb-2 text-text-main dark:text-white">Gestión de Zonas y Brigadistas</h2>
                    <p class="text-text-sub dark:text-slate-300 max-w-2xl text-sm font-medium">Administre la cobertura territorial y asigne personal operativo.</p>
                </div>
                <div class="flex flex-col sm:flex-row gap-2 h-full">
                    <button onclick="openDynamicMap()" class="flex-1 flex items-center justify-center gap-2 bg-purple-600 hover:bg-purple-700 text-white px-6 py-4 rounded-2xl font-semibold shadow-lg shadow-purple-500/30 hover:scale-[1.02] transition-all border-t border-white/20 active:scale-95 group">
                         <span class="material-symbols-outlined text-[24px]">map</span> <span class="hidden sm:inline">Ver Mapa Cobertura</span>
                    </button>
                    <button onclick="fetchSheetData()" class="flex-1 flex items-center justify-center gap-2 bg-primary hover:bg-primary-dark text-white px-6 py-4 rounded-2xl font-semibold shadow-lg shadow-primary/30 hover:shadow-primary/50 hover:scale-[1.02] transition-all border-t border-white/20 active:scale-95 group">
                        <span class="material-symbols-outlined text-[24px] group-hover:rotate-180 transition-transform duration-500">sync</span> <span class="hidden sm:inline">Recargar Datos</span>
                    </button>
                </div>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                <div class="glass-panel p-6 rounded-2xl relative overflow-hidden group border border-gray-100"><span class="material-symbols-outlined text-6xl text-text-main absolute top-0 right-0 p-4 opacity-10">map</span><div class="flex items-center gap-2 text-text-sub text-sm font-bold uppercase mb-2">Total Zonas</div><p class="text-4xl font-black text-text-main" id="stat-total-zonas">0</p></div>
                <div class="glass-panel p-6 rounded-2xl relative overflow-hidden group border border-green-200"><div class="absolute -right-4 -top-4 w-24 h-24 bg-green-500/10 blur-3xl rounded-full"></div><div class="flex items-center gap-2 text-green-700 text-sm font-bold uppercase mb-2">Asignadas</div><p class="text-4xl font-black text-text-main" id="stat-asignadas">0</p></div>
                <div class="glass-panel p-6 rounded-2xl relative overflow-hidden group border border-orange-200"><div class="absolute -right-4 -top-4 w-24 h-24 bg-orange-500/10 blur-3xl rounded-full"></div><div class="flex items-center gap-2 text-orange-700 text-sm font-bold uppercase mb-2">Pendientes</div><p class="text-4xl font-black text-text-main" id="stat-pendientes">0</p></div>
            </div>
        </div>

        <div class="glass-panel p-4 rounded-2xl border border-primary/20 shadow-md">
            <h3 class="text-xs font-bold text-text-sub uppercase tracking-wider mb-3 flex items-center gap-2"><span class="material-symbols-outlined text-primary text-sm">touch_app</span> Guía de Interacción</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                <div class="flex items-center gap-3 p-2 rounded-lg bg-blue-50/50 border border-blue-100"><div class="flex items-center justify-center size-8 rounded-full bg-blue-50 border border-blue-200 text-blue-600"><span class="material-symbols-outlined text-[18px]">public</span></div><div><p class="font-bold text-xs">Mapa Seccional</p><p class="text-[10px] text-text-sub">Mapa detallado de la sección.</p></div></div>
                <div class="flex items-center gap-3 p-2 rounded-lg bg-purple-50/50 border border-purple-100"><div class="flex items-center justify-center size-8 rounded-full bg-purple-50 border border-purple-200 text-purple-600"><span class="material-symbols-outlined text-[18px]">analytics</span></div><div><p class="font-bold text-xs">Datos Seccionales</p><p class="text-[10px] text-text-sub">Análisis estadístico.</p></div></div>
                <div class="flex items-center gap-3 p-2 rounded-lg bg-emerald-50/50 border border-emerald-100"><div class="inline-flex items-center gap-1 px-2 py-1 rounded-md bg-emerald-50 text-emerald-700 border border-emerald-200"><span class="material-symbols-outlined text-[14px]">map</span><span class="text-[10px] font-bold">Ver</span></div><div><p class="font-bold text-xs">Ubicación General</p><p class="text-[10px] text-text-sub">Ubicación en mapa general.</p></div></div>
            </div>
        </div>

        <div class="flex flex-col md:flex-row gap-4 items-center justify-between glass-panel p-3 rounded-2xl">
            <div class="relative w-full md:w-96 group"><span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">search</span><input id="searchInput" class="w-full pl-10 pr-4 py-2.5 glass-input rounded-xl text-sm font-medium" placeholder="Buscar zona, ID o brigadista..." type="text"/></div>
            <div class="flex flex-wrap items-center gap-4 w-full md:w-auto z-20">
                <div id="loading-indicator" class="hidden flex items-center gap-2 px-4 py-2 text-sm text-primary font-bold bg-primary/10 rounded-lg"><span class="size-4 border-2 border-primary border-t-transparent rounded-full animate-spin"></span> Actualizando...</div>
                <div class="relative min-w-[220px]" id="distritoDropdown">
                    <button onclick="toggleDistritoDropdown()" class="flex items-center justify-between w-full pl-4 pr-4 py-2.5 glass-input rounded-xl text-sm font-medium hover:bg-white hover:shadow-md transition-all"><div class="flex items-center gap-2"><span class="material-symbols-outlined text-gray-500">filter_alt</span><span id="distritoButtonText" class="truncate">Todos los Distritos</span></div><span class="material-symbols-outlined text-gray-400 text-sm" id="distritoArrow">expand_more</span></button>
                    <div id="distritoDropdownContent" class="hidden absolute top-full left-0 mt-2 w-full max-h-60 overflow-y-auto bg-white border border-gray-200 rounded-xl z-50 flex-col py-2 shadow-2xl"><div class="px-3 pb-2 border-b border-gray-100 sticky top-0 bg-white z-10 pt-1"><span class="text-xs font-bold text-text-sub uppercase">Seleccionar</span></div><div id="distritosCheckboxContainer" class="flex flex-col pt-1"></div></div>
                </div>
            </div>
        </div>

        <div class="glass-panel rounded-2xl overflow-hidden flex-1 flex flex-col z-0">
            <div class="overflow-x-auto">
                <table class="w-full min-w-[1000px] text-left border-collapse">
                    <thead class="bg-gray-50/80 border-b border-gray-200">
                        <tr>
                            <th class="px-6 py-5 text-xs font-bold text-text-sub uppercase w-[80px]">Orden</th>
                            <th class="px-6 py-5 text-xs font-bold text-text-sub uppercase w-[120px]">Zona</th>
                            <th class="px-6 py-5 text-xs font-bold text-text-sub uppercase w-[240px]">Sección</th>
                            <th class="px-6 py-5 text-xs font-bold text-text-sub uppercase w-[140px]">Estado</th>
                            <th class="px-6 py-5 text-xs font-bold text-text-sub uppercase w-[280px]">Brigadista</th>
                            <th class="px-6 py-5 text-xs font-bold text-text-sub uppercase w-[180px]">Teléfono</th>
                            <th class="px-6 py-5 text-xs font-bold text-text-sub uppercase w-[140px] text-center">Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="table-body" class="divide-y divide-gray-200"></tbody>
                </table>
            </div>
            <div class="px-6 py-4 border-t border-gray-200 flex items-center justify-between bg-gray-50/50"><p class="text-sm font-medium text-text-sub">Mostrando <span id="result-count" class="font-bold text-primary">0</span> resultados</p><div class="text-xs font-medium text-text-sub opacity-70 flex items-center gap-1"><span class="material-symbols-outlined text-xs">info</span> Los cambios se guardan automáticamente al salir.</div></div>
        </div>
    </main>

    <!-- METHODOLOGY & HISTORY VIEWS (Contenido Igual) -->
    <main id="methodologyView" class="hidden flex-1 max-w-[1440px] mx-auto w-full px-4 md:px-8 py-8 flex flex-col gap-8">
        <section class="mb-4">
            <div class="inline-block relative mb-6"><div class="title-backdrop"></div><h1 class="relative text-4xl font-black text-white drop-shadow-md">Metodología Geoestadística</h1></div>
            <div class="glass-panel bg-white/95 p-6 rounded-2xl shadow-lg border border-white/60">
                <div class="text-text-main mb-4"><pre class="preserve-whitespace font-sans text-sm md:text-base leading-relaxed text-text-main">
                     La metodología empleada para el análisis geoestadístico electoral es producto de explorar las distintas metodologías existentes y formar una propia.
<b>
                     Para calcular rentabilidad:
                     </b>
                   Combinamos principalmente la Formula - Herfindahl–Hirschman Index (HHI), y la de Nef (Laakso-Taagepera) Número Efectivo de Partidos (NEP). 
<b>
                     Para calcular el orden de despliegue territorial: 
</b>
                   Usamos principalmente el índice de Índice de Moran.
                   </pre></div>
            </div>
        </section>
        
        <section class="mb-4">
             <div class="inline-block relative mb-6"><div class="title-backdrop opacity-80"></div><h2 class="relative text-3xl font-bold text-white drop-shadow-md">Indicadores Tradicionales</h2></div>
             <div class="overflow-x-auto glass-panel bg-white/95 rounded-2xl shadow-lg border border-white/60">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-primary/10 backdrop-blur-sm"><tr><th class="px-6 py-4 text-left text-xs font-bold text-primary-dark uppercase">Indicador</th><th class="px-6 py-4 text-left text-xs font-bold text-primary-dark uppercase">Qué mide</th><th class="px-6 py-4 text-left text-xs font-bold text-primary-dark uppercase">Ideal para</th></tr></thead>
                    <tbody class="divide-y divide-gray-200 bg-white/50"><tr class="hover:bg-black/5"><td class="px-6 py-4 font-bold text-primary-dark">HHI</td><td class="px-6 py-4 text-text-sub">Concentración</td><td class="px-6 py-4 text-text-sub">Identificar bastiones</td></tr><tr class="hover:bg-black/5"><td class="px-6 py-4 font-bold text-primary-dark">Nef</td><td class="px-6 py-4 text-text-sub">Número partidos efectivos</td><td class="px-6 py-4 text-text-sub">Pluralismo real</td></tr></tbody>
                </table>
             </div>
        </section>

        <!-- (Resto de secciones de Metodología: Fórmulas, Umbrales, Densidad, Prioridades, Simplificación) -->
        <section class="mb-4"><h2 class="text-3xl font-bold text-primary mb-6 drop-shadow-sm">Fórmulas Clave</h2><div class="grid md:grid-cols-3 gap-6"><div class="glass-panel bg-white/95 p-6 rounded-2xl"><h4 class="font-bold text-primary-dark">HHI</h4><p class="text-sm text-text-sub">Índice de concentración.</p></div></div></section>
        <section class="mb-4"><div class="glass-panel bg-white/95 p-6 rounded-2xl flex flex-col items-center"><h3 class="text-xl font-bold mb-2">Curva Normal de Densidad</h3><img src="https://i.imgur.com/cftJ4sW.png" class="rounded-xl shadow-md max-w-full h-auto"></div></section>
        <section class="mb-4"><h2 class="text-3xl font-bold text-primary mb-6">Orden de prioridades</h2><div class="glass-panel bg-white/95 p-6 rounded-2xl flex justify-center"><img src="https://i.imgur.com/Yjg2d0j.png" class="rounded-xl shadow-md max-w-full h-auto"></div></section>
        <section class="mb-4"><div class="glass-panel bg-white/95 p-6 rounded-2xl flex justify-center"><img src="https://i.imgur.com/uE5HjYd.png" class="rounded-xl shadow-md max-w-full h-auto"></div></section>
    </main>

    <main id="historyView" class="hidden flex-1 max-w-[1440px] mx-auto w-full px-4 md:px-8 py-8 flex flex-col gap-8">
        <section class="mb-4">
             <div class="inline-block relative mb-6"><h1 class="text-4xl font-black text-primary drop-shadow-sm">Histórico de Resultados 2018-2024</h1></div>
            <div class="glass-panel bg-white/95 p-6 rounded-2xl mb-8 flex flex-col items-center"><h2 class="text-2xl font-bold text-primary mb-4 w-full text-left">2024</h2><img src="https://i.imgur.com/DdoqJIb.png" class="rounded-xl shadow-md max-w-full"></div>
            <div class="glass-panel bg-white/95 p-6 rounded-2xl mb-8 flex flex-col items-center"><h2 class="text-2xl font-bold text-primary mb-4 w-full text-left">2021</h2><img src="https://i.imgur.com/0kimyQo.png" class="rounded-xl shadow-md max-w-full"></div>
            <div class="glass-panel bg-white/95 p-6 rounded-2xl mb-8 flex flex-col items-center"><h2 class="text-2xl font-bold text-primary mb-4 w-full text-left">2018</h2><img src="https://i.imgur.com/jL4Aytf.png" class="rounded-xl shadow-md max-w-full"></div>
        </section>
    </main>

    <!-- GENERAL MAP MODAL (GOOGLE MAPS) -->
    <div id="generalMapModal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeGeneralMap()"></div>
        <div class="relative w-full max-w-5xl h-[80vh] glass-panel rounded-2xl flex flex-col shadow-2xl animate-in zoom-in-95 duration-200 bg-white">
            <div class="flex items-center justify-between p-4 border-b border-white/10">
                <h3 class="text-lg font-bold text-text-main flex items-center gap-2"><span class="material-symbols-outlined text-emerald-600">map</span> Mapa General</h3>
                <button onclick="closeGeneralMap()" class="p-2 hover:bg-black/5 rounded-full"><span class="material-symbols-outlined">close</span></button>
            </div>
            <div class="flex-1 bg-gray-100 rounded-b-2xl overflow-hidden relative">
                <iframe id="generalMapFrame" class="w-full h-full border-0" src="" allowfullscreen></iframe>
            </div>
        </div>
    </div>

    <!-- DYNAMIC MAP MODAL (LEAFLET) -->
    <div id="dynamicMapModal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeDynamicMap()"></div>
        <div class="relative w-full max-w-6xl h-[85vh] glass-panel rounded-2xl flex flex-col shadow-2xl animate-in zoom-in-95 duration-200 bg-white">
            <div class="flex items-center justify-between p-4 border-b border-gray-200">
                <div class="flex items-center gap-3">
                    <h3 class="text-xl font-bold text-text-main flex items-center gap-2"><span class="material-symbols-outlined text-primary">map</span> Mapa de Cobertura</h3>
                    <div class="flex gap-2 text-xs font-bold"><span class="px-2 py-1 rounded bg-green-100 text-green-700 border border-green-200">● Asignada</span><span class="px-2 py-1 rounded bg-orange-100 text-orange-700 border border-orange-200">● Pendiente</span></div>
                </div>
                <button onclick="closeDynamicMap()" class="p-2 hover:bg-black/5 rounded-full"><span class="material-symbols-outlined">close</span></button>
            </div>
            <div class="flex-1 relative bg-gray-100 rounded-b-2xl overflow-hidden">
                <div id="leafletMap"></div>
            </div>
        </div>
    </div>

    <script>
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxDMkP5NKfdb9xOjVBe20h7vff7KX4OR_8GKEsm42aszgq2ZgnOmXOX68pXSK0SB6Vw/exec';
        // Enlace Embed con parámetros correctos (ehbc y noprof)
        const GENERAL_MAP_URL = 'https://www.google.com/maps/d/embed?mid=1HLbLlf1Gl4OuR6RwUd0zENjCmhoA4II&ehbc=2E312F&noprof=1';
        // URL al GeoJSON local
        const GEOJSON_URL = 'zonas.geojson'; 

        let globalData = [], uniqueDistricts = new Set(), selectedDistricts = new Set(), sectionMaps = {}; 
        let mapInstance = null, geoJsonLayer = null;

        const districtsData = [
            { id: 2, url: 'https://distrito-local-1-ca46yhg.gamma.site/distrito-local-02-chihuahua' },
            { id: 3, url: 'https://distrito-local-1-ca46yhg.gamma.site/distrito-local-03-chihuahua' },
            { id: 4, url: 'https://distrito-local-1-ca46yhg.gamma.site/distrito-local-04-chihuahua' },
            { id: 5, url: 'https://distrito-local-1-ca46yhg.gamma.site/distrito-local-05-chihuahua' },
            { id: 6, url: 'https://distrito-local-1-ca46yhg.gamma.site/distrito-local-06-chihuahua' },
            { id: 7, url: 'https://distrito-local-1-ca46yhg.gamma.site/distrito-local-07-chihuahua' },
            { id: 8, url: 'https://distrito-local-1-ca46yhg.gamma.site/distrito-local-08-chihuahua' },
            { id: 9, url: 'https://distrito-local-1-ca46yhg.gamma.site/distrito-local-09-chihuahua' },
            { id: 10, url: 'https://distrito-local-1-ca46yhg.gamma.site/distrito-local-10-chihuahua' }
        ];

        function switchView(viewName) {
            ['dashboard', 'methodology', 'home', 'history'].forEach(v => document.getElementById(v + 'View').classList.add('hidden'));
            ['nav-dashboard', 'nav-methodology', 'nav-home', 'nav-history'].forEach(b => {
                const el = document.getElementById(b);
                el.classList.remove('bg-white', 'text-primary', 'shadow-md', 'border-primary/20', 'hover:scale-105', 'font-bold');
                el.classList.add('bg-white/80', 'text-text-sub', 'border-transparent', 'hover:bg-white', 'hover:shadow-md', 'hover:text-primary');
            });

            document.getElementById(viewName + 'View').classList.remove('hidden');
            const activeBtn = document.getElementById('nav-' + viewName);
            activeBtn.classList.remove('bg-white/80', 'text-text-sub', 'border-transparent', 'hover:bg-white', 'hover:shadow-md', 'hover:text-primary');
            activeBtn.classList.add('bg-white', 'text-primary', 'shadow-md', 'border-primary/20', 'hover:scale-105', 'font-bold');

            if (viewName === 'home') { document.body.classList.remove('bg-content'); document.body.classList.add('bg-home'); startCarousel(); }
            else { document.body.classList.remove('bg-home'); document.body.classList.add('bg-content'); stopCarousel(); }
        }

        // --- MAPAS (GENERAL Y DINÁMICO) ---
        function openGeneralMap() {
             const m = document.getElementById('generalMapModal');
             const f = document.getElementById('generalMapFrame');
             if (!f.src) f.src = GENERAL_MAP_URL;
             m.classList.remove('hidden');
             document.body.style.overflow = 'hidden';
        }
        function closeGeneralMap() {
             document.getElementById('generalMapModal').classList.add('hidden');
             document.body.style.overflow = '';
        }

        async function openDynamicMap() {
            document.getElementById('dynamicMapModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            setTimeout(async () => {
                if (!mapInstance) await initLeafletMap();
                else { mapInstance.invalidateSize(); updateMapColors(); }
            }, 100);
        }
        function closeDynamicMap() {
            document.getElementById('dynamicMapModal').classList.add('hidden');
            document.body.style.overflow = '';
        }

        async function initLeafletMap() {
            mapInstance = L.map('leafletMap').setView([31.73, -106.48], 11);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '&copy; OpenStreetMap contributors' }).addTo(mapInstance);
            
            try {
                console.log("Cargando GeoJSON desde: " + GEOJSON_URL);
                const response = await fetch(GEOJSON_URL);
                if (response.ok) {
                    const geoJsonData = await response.json();
                    geoJsonLayer = L.geoJSON(geoJsonData, { style: styleFeature, onEachFeature: onEachFeature }).addTo(mapInstance);
                    if (geoJsonData.features && geoJsonData.features.length > 0) mapInstance.fitBounds(geoJsonLayer.getBounds());
                } else console.error("Error al cargar zonas.geojson", response.status);
            } catch (e) { console.error("Error crítico cargando mapa:", e); }
        }

        function styleFeature(feature) {
            const props = feature.properties;
            const geoId = props.id || props.ID || props.Name || props.name || props.ZONA || props.zona || "";
            const cleanGeoId = String(geoId).trim();
            const zoneData = globalData.find(z => String(z.id).trim() === cleanGeoId);
            
            let color = '#94a3b8', opacity = 0.4;
            if (zoneData) {
                if (zoneData.assigned) { color = '#22c55e'; opacity = 0.6; }
                else { color = '#f97316'; opacity = 0.6; }
            }
            return { fillColor: color, weight: 2, opacity: 1, color: 'white', dashArray: '3', fillOpacity: opacity };
        }

        function updateMapColors() { if (geoJsonLayer) geoJsonLayer.setStyle(styleFeature); }

        function onEachFeature(feature, layer) {
             const props = feature.properties;
             const geoId = props.id || props.ID || props.Name || props.name || props.ZONA || props.zona || "Sin ID";
             const cleanGeoId = String(geoId).trim();
             const zoneData = globalData.find(z => String(z.id).trim() === cleanGeoId);
             let popupContent = `<div class="font-sans p-1"><h3 class="font-bold text-lg border-b border-gray-200 pb-1 mb-2">Zona: ${cleanGeoId}</h3>`;
             if (zoneData) {
                 const badge = zoneData.assigned ? `<span class="px-2 py-0.5 rounded-full bg-green-100 text-green-700 text-xs font-bold">ASIGNADA</span>` : `<span class="px-2 py-0.5 rounded-full bg-orange-100 text-orange-700 text-xs font-bold">PENDIENTE</span>`;
                 popupContent += `<div class="mb-2">${badge}</div><p class="text-sm"><strong>Brigadista:</strong> ${zoneData.brigadista || 'Sin asignar'}</p><p class="text-sm"><strong>Tel:</strong> ${zoneData.phone || '--'}</p><p class="text-xs text-gray-500 mt-2">Distrito: ${zoneData.district}</p>`;
             } else popupContent += `<p class="text-sm text-gray-500 italic">No hay datos en el Excel.</p>`;
             popupContent += `</div>`;
             layer.bindPopup(popupContent);
        }

        // --- LÓGICA DE DATOS Y TABLA (EXISTENTE) ---
        function renderDistrictsCarousel() {
            const container = document.getElementById('districtsContainer');
            container.innerHTML = '';
            districtsData.forEach(dist => {
                const card = document.createElement('div');
                card.className = "flex-none w-72 md:w-80 glass-panel rounded-2xl p-6 flex flex-col items-center justify-center gap-4 snap-center border border-white/40 shadow-xl group cursor-pointer carousel-card bg-white/95";
                card.onclick = () => window.open(dist.url, '_blank');
                card.innerHTML = `<div class="size-16 rounded-full bg-gradient-to-tr from-primary to-primary-dark flex items-center justify-center text-white font-black text-2xl shadow-lg group-hover:shadow-primary/50 transition-all">${dist.id}</div><div class="text-center"><h3 class="text-xl font-bold text-text-main dark:text-white">Distrito Local ${dist.id}</h3><p class="text-sm text-text-sub dark:text-gray-300 mt-1">Juárez</p></div><span class="mt-4 px-6 py-2.5 rounded-xl bg-gradient-to-r from-primary to-primary-dark text-white font-bold text-sm shadow-lg shadow-primary/30 group-hover:shadow-primary/50 group-hover:scale-105 transition-all flex items-center gap-2">Explorar <span class="material-symbols-outlined text-sm">arrow_forward</span></span>`;
                container.appendChild(card);
            });
        }
        function scrollDistricts(dir) {
            const c = document.getElementById('districtsContainer');
            c.scrollBy({ left: dir === 'left' ? -340 : 340, behavior: 'smooth' });
        }
        let carouselInterval;
        function startCarousel() {
            if (carouselInterval) clearInterval(carouselInterval);
            const c = document.getElementById('districtsContainer');
            if (!c) return;
            carouselInterval = setInterval(() => {
                if (c.scrollLeft + c.clientWidth >= c.scrollWidth - 50) c.scrollTo({ left: 0, behavior: 'smooth' });
                else c.scrollBy({ left: 340, behavior: 'smooth' });
            }, 3000);
        }
        function stopCarousel() { clearInterval(carouselInterval); }

        async function fetchSheetData() {
            document.getElementById('loading-indicator').classList.remove('hidden');
            try {
                const res = await fetch(APPS_SCRIPT_URL);
                const result = await res.json();
                const data = result.mainData || result;
                sectionMaps = result.sectionMaps || {};
                uniqueDistricts.clear();
                globalData = data.map((item, index) => {
                    const sections = item.zone ? String(item.zone).split(/[,|\/\-\n]/).map(s => s.trim()).filter(s => s.length > 0) : [];
                    if (sections.length === 0 && item.zone) sections.push(item.zone);
                    if (sections.length === 0) sections.push("Sin asignación");
                    let dist = item.district ? String(item.district).trim() : "N/A";
                    if(dist === "") dist = "N/A";
                    uniqueDistricts.add(dist);
                    return {
                        ...item, zoneSections: sections, order: item.order ? item.order : (index + 1).toString(),
                        district: dist, assigned: (item.status && (item.status.toLowerCase().includes('assigned') || item.status.toLowerCase().includes('asignada')))
                    };
                });
                globalData.sort((a, b) => parseInt(a.order) - parseInt(b.order));
                populateDistricts(Array.from(uniqueDistricts));
                filterAndRender();
                updateMapColors(); // Actualizar colores del mapa al cargar datos
            } catch (error) { console.error("Error fetching data:", error); } 
            finally { document.getElementById('loading-indicator').classList.add('hidden'); }
        }

        async function updateSheet(id, field, value, el) {
            if(el) el.classList.add('saving-pulse');
            try {
                await fetch(APPS_SCRIPT_URL, {
                    method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({ id, field, value })
                });
                const s = document.getElementById('save-status');
                s.classList.remove('hidden'); s.classList.add('flex');
                
                // Actualizar estado local y repintar mapa sin recargar
                const row = globalData.find(r => r.id === id);
                if (row) {
                    if (field === 'status') row.assigned = (value === 'assigned');
                    else if (field === 'brigadista') row.brigadista = value;
                    else if (field === 'phone') row.phone = value;
                    updateMapColors();
                }

                setTimeout(() => { s.classList.add('hidden'); s.classList.remove('flex'); }, 3000);
            } catch (error) { console.error("Save Error:", error); alert("Error al guardar."); }
            finally { if(el) el.classList.remove('saving-pulse'); }
        }
        
        function handleStatusChange(s, id) {
            s.className = s.value === 'assigned' ? "appearance-none cursor-pointer pl-3 pr-8 py-1.5 rounded-full text-xs font-bold border focus:ring-2 transition-all outline-none bg-green-100/80 text-green-700 border-green-200 backdrop-blur-sm shadow-sm" : "appearance-none cursor-pointer pl-3 pr-8 py-1.5 rounded-full text-xs font-bold border focus:ring-2 transition-all outline-none bg-gray-100/80 dark:bg-white/10 text-gray-600 dark:text-gray-300 border-gray-200 dark:border-white/10 backdrop-blur-sm shadow-sm";
            updateSheet(id, 'status', s.value, s);
        }

        function updateSectionMapLink(select, mapId, rowMap) {
            const sec = select.value;
            const mapAnchor = document.getElementById(mapId);
            const dataAnchor = document.getElementById(mapId.replace('map', 'data'));
            const info = sectionMaps[sec];
            let mUrl = null, dUrl = null;
            if (typeof info === 'string') mUrl = info; else if (typeof info === 'object' && info !== null) { mUrl = info.map; dUrl = info.data; }
            
            if (mUrl) { mapAnchor.href = mUrl; mapAnchor.classList.remove('opacity-50', 'pointer-events-none', 'grayscale'); mapAnchor.classList.add('hover:scale-110', 'hover:shadow-lg'); }
            else if (rowMap && rowMap.length > 5) { mapAnchor.href = rowMap; mapAnchor.classList.remove('opacity-50', 'pointer-events-none', 'grayscale'); mapAnchor.classList.add('hover:scale-110', 'hover:shadow-lg'); }
            else { mapAnchor.removeAttribute('href'); mapAnchor.classList.add('opacity-50', 'pointer-events-none', 'grayscale'); mapAnchor.classList.remove('hover:scale-110', 'hover:shadow-lg'); }

            if (dUrl) { dataAnchor.href = dUrl; dataAnchor.classList.remove('opacity-50', 'pointer-events-none', 'grayscale'); dataAnchor.classList.add('hover:scale-110', 'hover:shadow-lg'); }
            else { dataAnchor.removeAttribute('href'); dataAnchor.classList.add('opacity-50', 'pointer-events-none', 'grayscale'); dataAnchor.classList.remove('hover:scale-110', 'hover:shadow-lg'); }
        }

        function toggleDistritoDropdown() {
            const c = document.getElementById('distritoDropdownContent');
            c.classList.toggle('hidden'); c.classList.toggle('flex');
            document.getElementById('distritoArrow').style.transform = c.classList.contains('flex') ? 'rotate(180deg)' : 'rotate(0deg)';
        }
        document.addEventListener('click', (e) => {
            if (!document.getElementById('distritoDropdown').contains(e.target)) {
                document.getElementById('distritoDropdownContent').classList.add('hidden');
                document.getElementById('distritoDropdownContent').classList.remove('flex');
                document.getElementById('distritoArrow').style.transform = 'rotate(0deg)';
            }
        });
        document.addEventListener('keydown', (e) => { if (e.key === "Escape") { closeGeneralMap(); closeDynamicMap(); } });

        function populateDistricts(dists) {
            const c = document.getElementById('distritosCheckboxContainer');
            c.innerHTML = '';
            dists.sort((a,b) => (parseInt(a.replace(/\D/g,''))||0) - (parseInt(b.replace(/\D/g,''))||0));
            dists.forEach(d => {
                const l = document.createElement('label');
                l.className = "flex items-center gap-3 px-4 py-2 hover:bg-primary/10 dark:hover:bg-white/10 cursor-pointer transition-colors";
                l.innerHTML = `<input type="checkbox" value="${d}" class="form-checkbox size-4 text-primary rounded border-gray-300 dark:border-gray-500 bg-white/50 focus:ring-primary cursor-pointer" ${selectedDistricts.has(d)?'checked':''}> <span class="text-sm font-medium text-text-main dark:text-gray-200">${d.startsWith('Distrito')?d:`Distrito ${d}`}</span>`;
                l.querySelector('input').addEventListener('change', (e) => {
                    if (e.target.checked) selectedDistricts.add(d); else selectedDistricts.delete(d);
                    updateDistritoButtonLabel(); filterAndRender();
                });
                c.appendChild(l);
            });
            updateDistritoButtonLabel();
        }

        function updateDistritoButtonLabel() {
            const t = document.getElementById('distritoButtonText');
            if (selectedDistricts.size === 0) t.textContent = "Todos los Distritos";
            else if (selectedDistricts.size === 1) { const d = Array.from(selectedDistricts)[0]; t.textContent = d.startsWith('Distrito')?d:`Distrito ${d}`; }
            else t.textContent = `${selectedDistricts.size} Distritos Selecc.`;
        }

        function filterAndRender() {
            const term = document.getElementById('searchInput').value.toLowerCase();
            const filtered = globalData.filter(i => {
                const matches = i.zoneSections.join(" ").toLowerCase().includes(term) || (i.brigadista||"").toLowerCase().includes(term) || (i.id||"").toLowerCase().includes(term);
                const distMatch = selectedDistricts.size === 0 || selectedDistricts.has(i.district);
                return matches && distMatch;
            });
            renderTable(filtered);
            document.getElementById('result-count').textContent = filtered.length;
            updateStats(filtered);
        }

        function renderTable(data) {
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = '';
            if (data.length === 0) { tbody.innerHTML = `<tr><td colspan="7" class="px-6 py-12 text-center text-text-sub font-medium">No se encontraron resultados</td></tr>`; return; }
            data.forEach(r => {
                const tr = document.createElement('tr');
                const isPending = !r.assigned;
                tr.className = `group transition-colors border-b border-gray-100/30 dark:border-white/5 hover:bg-white/40 dark:hover:bg-white/5 ${isPending?'bg-orange-50/20 dark:bg-orange-900/10':''}`;
                const inpCls = isPending ? "glass-input w-full px-3 py-2 text-sm rounded-lg transition-all focus:ring-2 focus:ring-primary/50 outline-none shadow-sm" : "w-full px-3 py-2 text-sm rounded-lg transition-all focus:ring-2 focus:ring-primary/50 outline-none backdrop-blur-sm bg-transparent border-transparent hover:bg-white/40 dark:hover:bg-white/10 focus:bg-white/80 dark:focus:bg-slate-800/80 border hover:border-white/30";
                const stCls = r.assigned ? "bg-green-100/80 text-green-700 border-green-200 focus:ring-green-500" : "bg-gray-100/80 dark:bg-white/10 text-gray-600 dark:text-gray-300 border-gray-200 dark:border-white/10 focus:ring-gray-500";
                const mapId = `map-link-${r.id}`, dataId = `data-link-${r.id}`;
                tr.innerHTML = `
                    <td class="px-6 py-4 align-middle font-mono text-xs text-text-sub font-bold opacity-60">${r.order}</td>
                    <td class="px-6 py-4 align-middle"><span class="text-xs font-extrabold text-primary bg-primary/10 border border-primary/20 px-2.5 py-1 rounded-md whitespace-nowrap shadow-sm backdrop-blur-sm">${r.id}</span></td>
                    <td class="px-6 py-4 align-middle">
                        <div class="flex items-center gap-2">
                            <select onchange="updateSectionMapLink(this, '${mapId}', '${r.mapLink}')" class="w-full bg-transparent border-none text-sm font-bold text-text-main dark:text-white p-0 focus:ring-0 cursor-pointer appearance-none truncate pr-4 outline-none">${r.zoneSections.map(s=>`<option value="${s}">${s}</option>`).join('')}</select>
                            <a id="${mapId}" href="#" target="_blank" class="flex items-center justify-center size-8 rounded-full bg-blue-50 border border-blue-200 text-blue-600 shadow-sm hover:bg-blue-600 hover:text-white hover:border-blue-600 hover:shadow-lg hover:shadow-blue-500/30 transition-all duration-200 group/btn" title="Ver mapa"><span class="material-symbols-outlined text-[18px] group-hover/btn:scale-110 transition-transform">public</span></a>
                            <a id="${dataId}" href="#" target="_blank" class="flex items-center justify-center size-8 rounded-full bg-purple-50 border border-purple-200 text-purple-600 shadow-sm hover:bg-purple-600 hover:text-white hover:border-purple-600 hover:shadow-lg hover:shadow-purple-500/30 transition-all duration-200 group/btn opacity-50 pointer-events-none grayscale" title="Ver datos electorales"><span class="material-symbols-outlined text-[18px] group-hover/btn:scale-110 transition-transform">analytics</span></a>
                        </div>
                        <div class="text-[10px] font-semibold text-text-sub/70 mt-0.5 truncate max-w-[200px] flex items-center gap-1"><span class="size-1.5 rounded-full bg-primary/50"></span> Distrito: ${r.district||'N/A'}</div>
                    </td>
                    <td class="px-6 py-4 align-middle"><div class="relative inline-block"><select onchange="handleStatusChange(this, '${r.id}')" class="appearance-none cursor-pointer pl-3 pr-8 py-1.5 rounded-full text-xs font-bold border focus:ring-2 transition-all outline-none shadow-sm backdrop-blur-sm ${stCls}"><option value="pending" ${!r.assigned?'selected':''}>Pendiente</option><option value="assigned" ${r.assigned?'selected':''}>Asignada</option></select></div></td>
                    <td class="px-6 py-4 align-middle"><input class="${inpCls}" placeholder="Nombre" value="${r.brigadista||''}" onchange="updateSheet('${r.id}', 'brigadista', this.value, this)"></td>
                    <td class="px-6 py-4 align-middle"><input class="${inpCls}" placeholder="Teléfono" value="${r.phone||''}" onchange="updateSheet('${r.id}', 'phone', this.value, this)"></td>
                    <td class="px-6 py-4 align-middle text-center">${r.mapLink && r.mapLink.length>5 ? `<a href="${r.mapLink}" target="_blank" class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-emerald-50 text-emerald-700 border border-emerald-200 hover:bg-emerald-600 hover:text-white hover:border-emerald-600 transition-all shadow-sm hover:shadow-emerald-500/30 font-semibold text-xs group/map"><span class="material-symbols-outlined text-[16px] group-hover/map:animate-bounce">map</span> Ver Ubicación</a>` : `<span class="inline-flex items-center justify-center size-8 rounded-full bg-gray-100/50 dark:bg-white/5 text-gray-300 cursor-not-allowed"><span class="material-symbols-outlined text-[18px]">map_off</span></span>`}</td>
                `;
                tbody.appendChild(tr);
                const sel = tr.querySelector('select'); if(sel) updateSectionMapLink(sel, mapId, r.mapLink);
            });
        }
        
        function updateStats(data) {
            document.getElementById('stat-total-zonas').textContent = data.length;
            const asg = data.filter(d => d.assigned).length;
            document.getElementById('stat-asignadas').textContent = asg;
            document.getElementById('stat-pendientes').textContent = data.length - asg;
        }

        document.addEventListener('DOMContentLoaded', () => { renderDistrictsCarousel(); fetchSheetData(); startCarousel(); document.getElementById('searchInput').addEventListener('input', filterAndRender); });
    </script>
</body>
</html>